<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 1. What is functional programming?</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/fp_book_club_ts/assets/css/0.styles.f335e7b4.css" as="style"><link rel="preload" href="/fp_book_club_ts/assets/js/app.6b732bc4.js" as="script"><link rel="preload" href="/fp_book_club_ts/assets/js/5.44483b7a.js" as="script"><link rel="prefetch" href="/fp_book_club_ts/assets/js/2.cda51ec0.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/3.3c7491ba.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/4.5caeddb2.js">
    <link rel="stylesheet" href="/fp_book_club_ts/assets/css/0.styles.f335e7b4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fp_book_club_ts/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fp_book_club_ts/" class="nav-link">Home</a></div><div class="nav-item"><a href="/fp_book_club_ts/chapter_1.html" class="nav-link router-link-exact-active router-link-active">Chapters</a></div><div class="nav-item"><a href="https://github.com/calebharris/fp_book_club_ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fp_book_club_ts/" class="nav-link">Home</a></div><div class="nav-item"><a href="/fp_book_club_ts/chapter_1.html" class="nav-link router-link-exact-active router-link-active">Chapters</a></div><div class="nav-item"><a href="https://github.com/calebharris/fp_book_club_ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fp_book_club_ts/chapter_1.html" class="active sidebar-link">Chapter 1. What is functional programming?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_1.html#benefits-of-fp-a-simple-example" class="sidebar-link">Benefits of FP: a simple example</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="chapter-1-what-is-functional-programming"><a href="#chapter-1-what-is-functional-programming" aria-hidden="true" class="header-anchor">#</a> Chapter 1. What is functional programming?</h1> <p>We construct our programs using only <em>pure functions</em> - functions that have no <em>side effects</em>.</p> <p>A function has a side effect if it does anything other than return a value. Examples:</p> <ul><li>Modifying any state, such as a variable or data structure, in place</li> <li>Throwing an exception or exiting the program with an error</li> <li>Reading or writing a file</li> <li>Making a network request</li></ul> <h2 id="benefits-of-fp-a-simple-example"><a href="#benefits-of-fp-a-simple-example" aria-hidden="true" class="header-anchor">#</a> Benefits of FP: a simple example</h2> <p>We'll walk through refactoring a simple program to remove side effects and demonstrate some TypeScript syntax. We'll
also touch on two import concepts in functional programming: <em>referential transparency</em> and the <em>substitution model</em>.</p> <p>See <a href="https://github.com/calebharris/fp_book_club_ts/tree/master/fpbookclub/intro" target="_blank" rel="noopener noreferrer">the code repository<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for expanded,
runnable versions of these examples.</p> <h3 id="a-program-with-side-effects"><a href="#a-program-with-side-effects" aria-hidden="true" class="header-anchor">#</a> A program with side effects</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Cafe</span> <span class="token punctuation">{</span>                               <span class="token comment">//class keyword introduces a class, just</span>
                                           <span class="token comment">//  like every other OO language</span>

  <span class="token function">buyCoffee</span><span class="token punctuation">(</span>cc<span class="token punctuation">:</span> CreditCard<span class="token punctuation">)</span><span class="token punctuation">:</span> Coffee <span class="token punctuation">{</span>      <span class="token comment">//method of a class introduced by a name</span>
                                           <span class="token comment">//  followed by ()</span>
                                           <span class="token comment">//`cc: CreditCard` defines parameter</span>
                                           <span class="token comment">//  named `cc` of type `CreditCard`</span>
                                           <span class="token comment">//`: Coffee` declares the return type of</span>
                                           <span class="token comment">//  the method. compiler will error if the</span>
                                           <span class="token comment">//  method can possibly not return a</span>
                                           <span class="token comment">//  `Coffee` object</span>
    <span class="token keyword">const</span> cup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cc<span class="token punctuation">.</span><span class="token function">charge</span><span class="token punctuation">(</span>cup<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">//side effect: actually charges the card</span>
    <span class="token keyword">return</span> cup<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The line <code>cc.charge(cup.price)</code> is an example of a side effect. Charging a credit card involves some interaction
with the outside world. But the function's return value is just a <code>Coffee</code>, meaning this interaction is not easily
observable, making our function difficult to test. We can improve modularity and testability by introducing a
<code>Payments</code> object that encapsulates the payment processing logic and removing it from <code>CreditCard</code>.</p> <h3 id="adding-a-payments-object"><a href="#adding-a-payments-object" aria-hidden="true" class="header-anchor">#</a> Adding a Payments object</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Cafe</span> <span class="token punctuation">{</span>
  <span class="token function">buyCoffee</span><span class="token punctuation">(</span>cc<span class="token punctuation">:</span> CreditCard<span class="token punctuation">,</span> p<span class="token punctuation">:</span> Payments<span class="token punctuation">)</span><span class="token punctuation">:</span> Coffee <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">charge</span><span class="token punctuation">(</span>cc<span class="token punctuation">,</span> cup<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cup<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The side effect still happens. But we have improved testability because we can pass in a mock <code>Payments</code> object.
However, any mock will be awkward to use, because it will have to do things like maintain internal state that we can
inspect after the call to <code>charge()</code>. This is a bit much if all we want is to test that buyCoffee charges the correct
amount for a cup of coffee. It's also going to be tough to reuse buyCoffee. Say we wanted to buy 10 coffees: there is
no obvious way to do that without contacting the payment processor 10 times!</p> <h3 id="a-functional-solution-removing-the-side-effects"><a href="#a-functional-solution-removing-the-side-effects" aria-hidden="true" class="header-anchor">#</a> A functional solution: removing the side effects</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Cafe</span> <span class="token punctuation">{</span>
  <span class="token function">buyCoffee</span><span class="token punctuation">(</span>cc<span class="token punctuation">:</span> CreditCard<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Coffee<span class="token punctuation">,</span> Charge<span class="token punctuation">]</span> <span class="token punctuation">{</span>  <span class="token comment">//buyCoffee now returns a pair, or</span>
                                                 <span class="token comment">//  tuple, of the purchased Coffee</span>
                                                 <span class="token comment">//  and its associated Charge</span>
    <span class="token keyword">const</span> cup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> charge <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Charge</span><span class="token punctuation">(</span>cc<span class="token punctuation">,</span> cup<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>cup<span class="token punctuation">,</span> charge<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>Here, we've removed the side effect. Instead of immediately interacting with the payment processor, <code>buyCoffee</code> returns
a new <code>Charge</code> value object along with the <code>Coffee</code>. We can think of this as a description of what we want to happen,
rather than detailed instructions on how to accomplish it. Actually <em>interpreting</em> the meaning of <code>Charge</code> objects is
now a concern for elsewhere. In fact, <code>Cafe</code> no longer has any knowledge of how the process of charging the card works.
Let's look at <code>Charge</code> more closely:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Charge</span> <span class="token punctuation">{</span>                                   <span class="token comment">//once a Charge is created, it's</span>
  readonly cc<span class="token punctuation">:</span> CreditCard<span class="token punctuation">;</span>                       <span class="token comment">//  intended never to change, hence</span>
  readonly amount<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>                       <span class="token comment">//  the `readonly` markers</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>cc<span class="token punctuation">:</span> CreditCard<span class="token punctuation">,</span> amount<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cc <span class="token operator">=</span> cc<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>amount <span class="token operator">=</span> amount<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">combine</span><span class="token punctuation">(</span>other<span class="token punctuation">:</span> Charge<span class="token punctuation">)</span><span class="token punctuation">:</span> Charge <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cc <span class="token operator">==</span> other<span class="token punctuation">.</span>cc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Charge</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cc<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>amount <span class="token operator">+</span> other<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Can't combine charges to different cards&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Charge</code> is an immutable value object, equipped with a <code>combine()</code> function to merge two charges into one. Now we have
a way to more easily represent the idea of purchasing 10 coffees. We just need to combine the 10 charges into one.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">buyCoffees</span><span class="token punctuation">(</span>cc<span class="token punctuation">:</span> CreditCard<span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Coffee<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Charge<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cards<span class="token punctuation">:</span> CreditCard<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>cc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> purchases <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>cards<span class="token punctuation">,</span> cc <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buyCoffee</span><span class="token punctuation">(</span>cc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//this part is a bit ugly, but we're just splitting the array of [Coffee, Charge]</span>
  <span class="token comment">//  tuples into one Coffee array and one Charge array</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>coffees<span class="token punctuation">,</span> charges<span class="token punctuation">]</span> <span class="token operator">=</span> purchases<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>coffees<span class="token punctuation">,</span> charges<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>coffee<span class="token punctuation">,</span> charge<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    coffees<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>coffee<span class="token punctuation">)</span><span class="token punctuation">;</span>
    charges<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>charge<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>coffees<span class="token punctuation">,</span> charges<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>coffees<span class="token punctuation">,</span> charges<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> l<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Our functional solution has significant advantages over the previous two iterations. It's easier to test, since all we
need to do is assert that the <code>Charge</code> objects have the expected values in their <code>cc</code> and <code>amount</code> properties. It's
also easier to combine simple, low-level behavior into more advanced functionality. Look how straightforward it was to
implement batch charging! Finally, we can imagine that the library for communicating with the payment processor is made
simpler by this approach. It only needs to issue the correct commands for any given value of <code>Charge</code>.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p>If you've been following along in <em>Functional Programming in Scala</em>, you may have noticed that the Scala code
corresponding to these snippets is more compact and elegant. For instance, TypeScript doesn't have the notion of
<code>case</code> classes, requiring us to write a little more boilerplate to achieve the same end. It also lacks an <code>unzip</code>
for easily separating a sequence of tuples into a tuple of sequences. In general, TypeScript's standard library (which
is really just JavaScript's) is less comprehensive than Scala's.</p> <p>On the other hand, TypeScript has better destructuring support (e.g. <code>const [coffees, charges] = ...</code>) and is a
relatively thin enhancement to JavaScript, giving it great applicability to web programming. Many people find the
experience of developing software with Node.js to be a joy (and, conversely, developing with anything JVM-based to be a
constant time-suck).</p> <p>Later on, we'll have to employ some advanced, potentially difficult-to-understand techniques to get the same expressive
power from TypeScript's types as we can with Scala's. Still, TypeScript is a powerful, easy-to-deploy, and
rapidly-evolving language that drastically improves our ability to manage and maintain large JavaScript projects.</p></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/fp_book_club_ts/assets/js/5.44483b7a.js" defer></script><script src="/fp_book_club_ts/assets/js/app.6b732bc4.js" defer></script>
  </body>
</html>
